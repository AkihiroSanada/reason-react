<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>ReasonReactCompat: migrating to 0.7.0 and JSX v3 · reason-react</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="In version 0.7.0, two large changes were introduced:"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="ReasonReactCompat: migrating to 0.7.0 and JSX v3 · reason-react"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reasonml.github.io/reason-react/reason-react/"/><meta property="og:description" content="In version 0.7.0, two large changes were introduced:"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/reason-react/img/reason-react-favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><link rel="alternate" type="application/atom+xml" href="https://reasonml.github.io/reason-react/reason-react/blog/atom.xml" title="reason-react Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://reasonml.github.io/reason-react/reason-react/blog/feed.xml" title="reason-react Blog RSS Feed"/><script type="text/javascript" src="/reason-react/js/pjax-api.min.js"></script><script src="/reason-react/js/scrollSpy.js"></script><link rel="stylesheet" href="/reason-react/css/main.css"/><script src="/reason-react/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/reason-react/en"><img class="logo" src="/reason-react/img/reason-react-white.svg" alt="reason-react"/><h2 class="headerTitleWithLogo">reason-react</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/reason-react/docs/en/installation" target="_self">Docs</a></li><li class=""><a href="/reason-react/docs/en/playground" target="_self">Try</a></li><li class=""><a href="/reason-react/docs/en/simple" target="_self">Examples</a></li><li class=""><a href="/reason-react/docs/en/community" target="_self">Community</a></li><li class=""><a href="/reason-react/blog/" target="_self">Blog</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/reason-react/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/reason-react/docs/ja/reasonreactcompat">日本語</a></li><li><a href="/reason-react/docs/es-ES/reasonreactcompat">Español</a></li><li><a href="/reason-react/docs/fr/reasonreactcompat">Français</a></li><li><a href="/reason-react/docs/ko/reasonreactcompat">한국어</a></li><li><a href="/reason-react/docs/pt-BR/reasonreactcompat">Português (Brasil)</a></li><li><a href="/reason-react/docs/ru/reasonreactcompat">Русский</a></li><li><a href="/reason-react/docs/zh-CN/reasonreactcompat">中文</a></li><li><a href="/reason-react/docs/zh-Hant/reasonreactcompat">繁體中文</a></li><li><a href="https://crowdin.com/project/reason-react" target="_blank" rel="noreferrer noopener">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/reasonml/reason-react" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Core</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/what-and-why">What &amp; Why</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/intro-example">Intro Example</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Core</h3><ul class=""><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/components">Components</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/jsx">JSX (Version 3)</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/event">Event</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/style">Style</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/router">Router</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/dom">Working with DOM</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/refs">Refs in React</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/reason-react/docs/en/reasonreactcompat">ReasonReactCompat: migrating to 0.7.0 and JSX v3</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/testing">Testing ReasonReact components</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">ReactJS Idioms Equivalents</h3><ul class=""><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/invalid-prop-name">Invalid Prop Name</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/props-spread">Props Spread</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/component-as-prop">Component as Prop</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/ternary-shortcut">Ternary Shortcut</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/context-mixins">Context &amp; Mixins</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/custom-class-component-property">Custom Class/Component Property</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/usestate-event-value">Using Event Values With useState</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/error-boundaries">Error boundaries</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Record API (deprecated)</h3><ul class=""><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/jsx-2">JSX (Old, Version 2)</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/creation-props-self">Creation, Props &amp; Self</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/render">Render</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/callback-handlers">Callback Handlers</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/state-actions-reducer">State, Actions &amp; Reducer</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/lifecycles">Lifecycles</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/instance-variables">Instance Variables</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/react-ref">React Ref</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/interop">Talk to Existing ReactJS Code</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/clone-element">cloneElement</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/children">Children</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/subscriptions-helper">Subscriptions Helper</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/router-2">Router</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul class=""><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/im-having-a-type-error">I&#x27;m Having a Type Error</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/record-field-send-handle-not-found">Record Field send/handle Not Found</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/send-handle-callbacks-having-incompatible-types">send/handle callbacks having Incompatible Types</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/i-really-need-feature-x-from-reactjs">I Really Need Feature X From ReactJS</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/element-type-is-invalid">Element Type is Invalid Runtime Error</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en/i-want-to-create-a-dom-element-without-jsx">I want to create a DOM element without JSX</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/reasonml/reason-react/tree/main/docs/reasonreactcompat.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">ReasonReactCompat: migrating to 0.7.0 and JSX v3</h1></header><article><div><span><p>In version 0.7.0, two large changes were introduced:</p>
<ul>
<li>Support for React hooks</li>
<li>A new JSX version (v3)</li>
</ul>
<p>You can read more in the release <a href="https://reasonml.github.io/reason-react/blog/2019/04/10/react-hooks">blog post</a>.</p>
<p>To enable the progressive migrations of existing ReasonReact applications to the new API and JSX version, a new module called <code>ReasonReactCompat</code> was added to ReasonReact.</p>
<h2><a class="anchor" aria-hidden="true" id="react-and-reasonreact-modules"></a><a href="#react-and-reasonreact-modules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React and ReasonReact modules</h2>
<p><code>ReasonReactCompat</code> is a bridge between two modules:</p>
<ul>
<li><code>ReasonReact</code>: contains the now frozen API that was used to implement components in v0.6.0 and earlier using JSX v2.</li>
<li><code>React</code>: the module that contains the hooks-compatible API, that is available since v0.7.0 and uses JSX v3.</li>
</ul>
<p>JSX versions 2 and 3 are coupled with the corresponding modules <code>ReasonReact</code> and <code>React</code>. In other words: a component created using <code>ReasonReact</code> module will require JSX v2, and a component built using <code>React</code> module will require JSX v3.</p>
<p>For clarity and brevity, in the rest of the section we will refer to each group as follows:</p>
<ul>
<li><code>ReasonReact</code> components (&lt; 0.7.0) that use JSX v2, as <strong>v2 components</strong></li>
<li><code>React</code> components (&gt;= 0.7.0) that use JSX v3, as <strong>v3 components</strong>.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="wrapreactforreasonreact-wrapping-a-v3-component-to-be-used-from-a-v2-component"></a><a href="#wrapreactforreasonreact-wrapping-a-v3-component-to-be-used-from-a-v2-component" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>wrapReactForReasonReact</code>: Wrapping a v3 component to be used from a v2 component</h2>
<p>In most cases, we will want to migrate our application to use v3 components (see the section about migration strategies <a href="https://reasonml.github.io/reason-react/docs/en/reasonreactcompat.html#migrating-an-application-to-v070-and-jsx-v3">below</a>).</p>
<p>For example, a v2 component <code>Banner</code> might need to use a v3 component <code>Image</code>. <code>Image</code> can be made compatible by leveraging <code>ReasonReactCompat.wrapReactForReasonReact</code>:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* In Image.re */</span>
<span class="hljs-attribute">[@bs.config {jsx: 3}]</span>;

<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~src) =&gt; &lt;img src /&gt;;

<span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Jsx2</span> = {
  <span class="hljs-keyword">let</span> component = <span class="hljs-module-identifier">ReasonReact</span>.statelessComponent(<span class="hljs-string">"Image"</span>);
  <span class="hljs-comment">/* `children` is not labelled, as it is a regular parameter in version 2 of JSX */</span>
  <span class="hljs-keyword">let</span> make = (~src, children) =&gt;
    <span class="hljs-module-identifier">ReasonReactCompat</span>.wrapReactForReasonReact(
      make,
      makeProps(~src, ()),
      children,
    );
};
</code></pre>
<p>Then, <code>Image</code> can be used from <code>Banner</code>:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* In Banner.re */</span>
<span class="hljs-keyword">let</span> component = <span class="hljs-module-identifier">ReasonReact</span>.statelessComponent(<span class="hljs-string">"Banner"</span>);

<span class="hljs-keyword">let</span> make = _children =&gt; {
  <span class="hljs-operator">...</span>component,
  render: _self =&gt; &lt;<span class="hljs-module-identifier">Image</span>.<span class="hljs-constructor">Jsx2</span> src=<span class="hljs-string">"./cat.gif"</span> /&gt;,
};
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="component-with-children"></a><a href="#component-with-children" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Component with <code>children</code></h3>
<p>Some components pass down <code>children</code> transparently, like:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* In SomeButton.re */</span>
<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~children) =&gt; &lt;button&gt; children &lt;/button&gt;;
</code></pre>
<p>If this kind of components need to expose a <code>Jsx2</code> module for backwards compatibility, like seen above, you might run into errors like:</p>
<pre><code class="hljs">This expression has<span class="hljs-built_in"> type </span>array(<span class="hljs-string">'a)
but an expression was expected of type
ReasonReact.reactElement = React.element
</span></code></pre>
<p>In these cases, it is helpful to wrap <code>children</code> with <code>React.array</code> inside the <code>Jsx2</code> compatibility module, like:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* In SomeButton.re */</span>
<span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Jsx2</span> = {
  <span class="hljs-keyword">let</span> component = <span class="hljs-module-identifier">ReasonReact</span>.statelessComponent(<span class="hljs-string">"SomeButton"</span>);
  <span class="hljs-keyword">let</span> make = children =&gt; {
    <span class="hljs-keyword">let</span> children = <span class="hljs-module-identifier">React</span>.array(children);
    <span class="hljs-module-identifier">ReasonReactCompat</span>.wrapReactForReasonReact(
      make,
      makeProps(~children, ()),
      children,
    );
  };
};
</code></pre>
<p>The reason behind those errors is that version 3 of JSX doesn't automatically wrap the <code>children</code> passed to an element in an array, like version 2 used to do. Using <code>React.array</code> in the <code>Jsx2</code> module is a way to provide a consistent behavior for usages of the component in both versions of the JSX transform.</p>
<h2><a class="anchor" aria-hidden="true" id="wrapreasonreactforreact-wrapping-a-v2-component-to-be-used-from-a-v3-component"></a><a href="#wrapreasonreactforreact-wrapping-a-v2-component-to-be-used-from-a-v3-component" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>wrapReasonReactForReact</code>: Wrapping a v2 component to be used from a v3 component</h2>
<p>Sometimes we might need to make the translation the other way around: wrap a v2 component to be used from a v3 component. For example, if we are using some ReasonReact library that has not been updated yet to be compatible with the latest version.</p>
<p>In these cases, we can use <code>ReasonReact.wrapReasonReactForReact</code>.</p>
<p>Let's say we have a v2 component <code>Text</code> that needs to be used from a v3 component <code>Heading</code>:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* In Text.re */</span>
<span class="hljs-keyword">let</span> component = <span class="hljs-module-identifier">ReasonReact</span>.statelessComponent(<span class="hljs-string">"Text"</span>);

<span class="hljs-keyword">let</span> make = (~text, _children) =&gt; {
  <span class="hljs-operator">...</span>component,
  render: _self =&gt; &lt;span&gt; {<span class="hljs-module-identifier">ReasonReact</span>.string(text)} &lt;/span&gt;,
};
</code></pre>
<p>We can follow the same approach as above and add a <code>Jsx3</code> module to the same file:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* Still in Text.re */</span>
<span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Jsx3</span> = {
  <span class="hljs-attribute">[@bs.obj]</span> <span class="hljs-keyword">external</span> makeProps: (~text: string, unit) =&gt; _ = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">let</span> make =
    <span class="hljs-module-identifier">ReasonReactCompat</span>.wrapReasonReactForReact(
      ~component, (reactProps: {. <span class="hljs-string">"text"</span>: string}) =&gt;
      make(~text=reactProps##text, <span class="hljs-literal">[|</span><span class="hljs-literal">|]</span>)
    );
};
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="component-with-children-1"></a><a href="#component-with-children-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Component with <code>children</code></h3>
<p>If the v2 component we want to migrate uses <code>children</code> we have to take some extra steps to convert it.</p>
<p>For example, let's say we have a <code>List</code> v2 component:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* List.re */</span>
<span class="hljs-keyword">let</span> component = <span class="hljs-module-identifier">ReasonReact</span>.statelessComponent(<span class="hljs-string">"List"</span>);

<span class="hljs-keyword">let</span> make = (~visible, children) =&gt; {
  <span class="hljs-operator">...</span>component,
  render: _self =&gt; visible ? &lt;div&gt; <span class="hljs-operator">...</span>children &lt;/div&gt; : <span class="hljs-module-identifier">ReasonReact</span>.null,
};
</code></pre>
<p>The <code>Jsx3</code> compat module will look like:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* Still in List.re */</span>
<span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Jsx3</span> = {
  <span class="hljs-attribute">[@bs.obj]</span>
  <span class="hljs-keyword">external</span> makeProps: (~visible: bool, ~children: 'children=?, unit) =&gt; _ = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">let</span> make =
    <span class="hljs-module-identifier">ReasonReactCompat</span>.wrapReasonReactForReact(
      ~component,
      (
        reactProps: {
          .
          <span class="hljs-string">"visible"</span>: bool,
          <span class="hljs-string">"children"</span>: 'children,
        },
      ) =&gt;
      make(
        ~visible=reactProps##visible,
        reactProps##children
        <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Js</span>.<span class="hljs-module-identifier">Undefined</span>.toOption
        <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Option</span>.mapWithDefault(<span class="hljs-literal">[|</span><span class="hljs-literal">|]</span>, c =&gt; <span class="hljs-literal">[|</span>c<span class="hljs-literal">|]</span>),
      )
    );
};
</code></pre>
<p>Because v3 components using <code>List.Jsx3</code> can decide whether to pass <code>children</code> or not, we have to account for those cases by setting <code>children</code> as optional labelled argument in <code>makeProps</code>. After that, we also have convert <code>children</code> to an array inside <code>make</code> before passing control over to the v2 implementation.</p>
<h2><a class="anchor" aria-hidden="true" id="migrating-an-application-to-v070-and-jsx-v3"></a><a href="#migrating-an-application-to-v070-and-jsx-v3" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Migrating an application to v0.7.0 and JSX v3</h2>
<p>There are many ReasonReact applications, so it is hard to define &quot;The One True&quot; migration strategy for them all.</p>
<p>Depending on the size and nature of your application there are two options available to migrate your application from 0.6.0 to 0.7.0.</p>
<h3><a class="anchor" aria-hidden="true" id="application-level"></a><a href="#application-level" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Application level</h3>
<p>By adding <code>{&quot;reason&quot;: {&quot;react-jsx&quot;: 3}</code> in your <a href="https://bucklescript.github.io/docs/en/build-configuration.html#reason-refmt"><code>bsconfig.json</code></a>.</p>
<p>This approach requires that all components in the application must be made compatible with version 3 of JSX at once, so it will be a better fit for smaller apps with a reduced number of components, where all of them can be migrated to version 3 in one fell swoop.</p>
<h3><a class="anchor" aria-hidden="true" id="file-level"></a><a href="#file-level" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>File level</h3>
<p>For larger applications, it might not be possible to migrate all components at once. In these cases, a per-file migration is also possible.</p>
<p>A file can be configured to use version 3 of the transform by adding <code>[@bs.config {jsx: 3}];</code> at the top of the file.</p>
<p>The per-file configuration allows to mix, in the same application, components compatible with either of both versions of the JSX transforms. However, the restriction is that all the components used in a file will have to be compatible with the JSX version specified for that file.</p>
<p>For example, if a file contains the following code:</p>
<pre><code class="hljs css language-reason"><span class="hljs-comment">/* User.re */</span>
<span class="hljs-attribute">[@bs.config {jsx: 3}]</span>;

<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~id) =&gt; {
  &lt;<span class="hljs-module-identifier">Profile</span>&gt;
    &lt;<span class="hljs-module-identifier">UserDetails</span> id /&gt;
  &lt;/<span class="hljs-module-identifier">Profile</span>&gt;;
};
</code></pre>
<p>Then <code>Profile</code> and <code>UserDetails</code> components will have to be compatible with the version 3 of JSX. Or alternatively, if they are using version 2, they can be wrapped with the function <code>ReasonReactCompat.wrapReasonReactForReact</code>, as seen in <a href="https://reasonml.github.io/reason-react/docs/en/reasonreactcompat.html#wrapreasonreactforreact-wrapping-a-v2-component-to-be-used-from-a-v3-component">the section above</a>.</p>
<h4><a class="anchor" aria-hidden="true" id="from-primitives-to-more-complex-components"></a><a href="#from-primitives-to-more-complex-components" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From primitives to more complex components</h4>
<p>As all usages of any component in a file need to be migrated to the same version of JSX, one natural way to tackle large migrations at the file level is to start converting the most primitive components to version 3, as they generally render elements of a reduced number of components, or host elements like <code>&lt;div /&gt;</code>. Once the most simple components are done, one can proceed with the most complex ones.</p>
<p>Once all components are using version 3, there is no more need to keep the <code>[@bs.config {jsx: 3}];</code> annotations at the top of each file, and they can be replaced by bumping the JSX version in the <code>bsconfig.json</code> file to <code>{&quot;reason&quot;: {&quot;react-jsx&quot;: 3}</code> for the whole application.</p>
<h3><a class="anchor" aria-hidden="true" id="upgrade-script"></a><a href="#upgrade-script" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrade script</h3>
<p>A migration script <a href="https://github.com/chenglou/upgrade-reason-react#installation">is provided</a> to facilitate the task to convert components to version 3. It will wrap existing ReasonReact components as if they are Hooks components. This script will not attempt to re-write your logic as hooks because this is often a complicated process and it is not guaranteed to be correct. Please always inspect and test the work of the migration script to make sure it does what you are expecting.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/reason-react/docs/en/refs"><span class="arrow-prev">← </span><span>Refs in React</span></a><a class="docs-next button" href="/reason-react/docs/en/testing"><span class="function-name-prevnext">Testing ReasonReact components</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#react-and-reasonreact-modules">React and ReasonReact modules</a></li><li><a href="#wrapreactforreasonreact-wrapping-a-v3-component-to-be-used-from-a-v2-component"><code>wrapReactForReasonReact</code>: Wrapping a v3 component to be used from a v2 component</a><ul class="toc-headings"><li><a href="#component-with-children">Component with <code>children</code></a></li></ul></li><li><a href="#wrapreasonreactforreact-wrapping-a-v2-component-to-be-used-from-a-v3-component"><code>wrapReasonReactForReact</code>: Wrapping a v2 component to be used from a v3 component</a><ul class="toc-headings"><li><a href="#component-with-children-1">Component with <code>children</code></a></li></ul></li><li><a href="#migrating-an-application-to-v070-and-jsx-v3">Migrating an application to v0.7.0 and JSX v3</a><ul class="toc-headings"><li><a href="#application-level">Application level</a></li><li><a href="#file-level">File level</a></li><li><a href="#upgrade-script">Upgrade script</a></li></ul></li></ul></nav></div><span><script src="/reason-react/js/redirectBlog.js"></script><script>window.foo = new Pjax({
          areas: [
            // try to use the first query.
            '.mainContainer, .docsNavContainer .toc .navWrapper, .onPageNav',
            // fallback
            'body'
          ],
          link: '.docsNavContainer:not(.docsSliderActive) a',
          update: {
            script: false,
          }
        });
        var languagesMenuItemCopy = document.getElementById("languages-menu");
        languagesMenuItemCopy.addEventListener("click", function(e){
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        });</script></span></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '55156da6520de795d3a2c2d23786f08e',
                indexName: 'react-reason',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["lang:en"]}
              });
            </script></body></html>